<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      :root { color-scheme: light; }
      body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif; line-height: 1.6; padding: 16px; }
      h1 { font-size: 20px; margin: 0 0 12px; }
      h2 { font-size: 16px; margin: 18px 0 8px; border-top: 1px solid #eee; padding-top: 12px; }
      h3 { font-size: 14px; margin: 14px 0 6px; }
      p { margin: 8px 0; }
      ul, ol { margin: 8px 0 8px 20px; padding: 0; }
      li { margin: 4px 0; }
      code { background: #f6f8fa; padding: 1px 4px; border-radius: 4px; }
      pre { background: #f6f8fa; padding: 10px; border-radius: 8px; overflow: auto; }
      pre code { background: none; padding: 0; }
      .footer { margin-top: 18px; font-size: 12px; color: #666; }
    </style>
  </head>
  <body>
<h1>運用マニュアル（クライアント向け）: 車両リース契約 更新通知ツール</h1>
<p>このドキュメントは、スプレッドシート上で「契約満了が近い車両」を部署へ通知し、Webで回答を集め、台帳へ反映するための<strong>日常運用手順</strong>をまとめたものです。</p>
<p>（作成日: 2026-01-18）</p>
<hr>
<h2>1. このツールでできること（ざっくり）</h2>
<ol>
<li>満了が近い車両を自動で拾う（例: 6か月以内）</li>
<li>管理部門へメールで「回答リンク」を送る（部署ごとに1通）</li>
<li>各部署はWeb画面で「更新方針」を回答する（再リース/新車入替/廃止/未定）</li>
<li>回答結果をスプレッドシート（台帳）へ反映する</li>
<li>部署別の集計（回答集計）を確認できる（必要なら管理者へサマリメール）</li>
</ol>
<p>補足:</p>
<ul>
<li>初回メール送信後、未回答が残っている部署には、設定に従ってリマインドメールが自動送信されます（最大回数まで）。</li>
</ul>
<hr>
<h2>2. 触る場所（タブ）</h2>
<p>普段よく見るのは次のタブです。</p>
<ul>
<li><code>車両一覧</code> / <code>車両一覧【ｹﾝｽｲ】</code> / <code>車両一覧【ﾈｸｽﾄ】</code>（元台帳）</li>
<li>ここにある「契約満了日」「管理部門」などを元に判定します</li>
<li>回答結果は、右端に列が追加されて書き戻されます（後述）</li>
<li><code>要入力</code></li>
<li>「契約満了日が無い」「管理部門が無い/未登録」など、通知できない原因が一覧で出ます</li>
<li><code>更新依頼</code></li>
<li>部署ごとの依頼（requestId）と、進み具合（ステータス）が入ります</li>
<li><code>通知ログ</code></li>
<li>メール送信の成功/失敗が記録されます（まずここを見る）</li>
<li><code>回答集計</code></li>
<li>部署別の回答数（再リース/新車入替/廃止/未定/未回答）が見られます</li>
</ul>
<hr>
<h2>3. 回答する人（各管理部門）の手順</h2>
<p>メールが届いたら、次だけやればOKです。</p>
<ol>
<li>メール内の「回答URL」を開く</li>
<li>画面で、車両ごとに「更新方針」を選ぶ</li>
<li>必要なら「コメント」を入れる（任意）</li>
<li>最後に「回答を送信」を押す</li>
</ol>
<p>注意:</p>
<ul>
<li>できるだけ<strong>対象の車両すべて</strong>に回答してください（未入力が残ると「未回答」として集計に残ります）。</li>
<li>回答URLは社内情報です。<strong>社外へ転送しないでください</strong>。</li>
<li>送信後に画面が「受付しました」になれば完了です。</li>
</ul>
<hr>
<h2>4. 運用担当（車両管理者）の毎日のやること</h2>
<h3>4.1 基本（平常運転）</h3>
<ul>
<li>原則、平日朝に自動で動きます（目安: 平日 8:00）。</li>
<li>管理者宛のサマリメールが来ていれば、まずはその内容を確認します。</li>
<li>スプレッドシートで見る場合は <code>回答集計</code> を開き、未回答が残っている部署がないか確認します。</li>
</ul>
<p>必要なときだけ手動実行:</p>
<ul>
<li>すぐに最新化したい場合は、メニュー <code>車両更新通知</code> → <code>日次一括実行</code> を押します（当日の処理をまとめて実行します）。</li>
</ul>
<h3>4.2 未回答が残っているとき</h3>
<ul>
<li><code>回答集計</code> の「未回答」が残っている部署があれば、まず状況を確認します（リマインドは設定に従い自動送信されます）。</li>
<li>リマインド回数の上限に達しても未回答が残る場合は、社内の通常連絡で督促します。</li>
<li>必要なら、該当部署へ「通知メールの再送」や「リンク再共有」をします（手順は「困ったとき」を参照）。</li>
</ul>
<hr>
<h2>5. 初期設定（最初に1回だけ）</h2>
<p>※ここは「スプレッドシートの管理者」向けです。設定済みなら飛ばしてください。</p>
<h3>5.1 メニューが出ることを確認</h3>
<p>スプレッドシートを開くと、上部メニューに <code>車両更新通知</code> が出ます。</p>
<p>初回は権限確認が出ることがあります。案内に従って許可してください。</p>
<h3>5.2 必要タブを作る（スキーマ同期）</h3>
<p>メニュー <code>車両更新通知</code> → <code>スキーマ同期</code></p>
<p>これで運用タブ（<code>設定</code> / <code>部署マスタ</code> / <code>更新依頼</code> など）が作られます。</p>
<h3>5.3 部署マスタを入れる（通知先の管理）</h3>
<p>タブ <code>部署マスタ</code> に、部署ごとに次を入れます。</p>
<ul>
<li>管理部門（台帳の表記と揃える）</li>
<li>通知先To（メールアドレス）</li>
<li>通知先Cc（必要なら）</li>
<li>有効（TRUE/FALSE）</li>
</ul>
<p>入れたら、メニュー <code>車両更新通知</code> → <code>部署トークン生成(空欄のみ)</code> を実行します。</p>
<h3>5.4 設定を入れる</h3>
<p>タブ <code>設定</code> で、最低限次を確認します。</p>
<ul>
<li><code>抽出_満了まで月数</code>（通常は 6）</li>
<li><code>Web回答URL（デプロイURL）</code>（空だとメール送信できません）</li>
<li><code>管理者_通知先To</code>（サマリメールが必要な場合）</li>
<li><code>通知_メール送信</code>（TRUEで送信、FALSEで送らない）</li>
</ul>
<h3>5.5 自動実行（平日朝）を設定する</h3>
<p>自動実行が必要な場合は、メニュー <code>車両更新通知</code> → <code>日次トリガー再作成</code> を実行します。</p>
<hr>
<h2>6. 困ったとき（よくある原因と対処）</h2>
<h3>6.1 メールが送られていない/失敗している</h3>
<ol>
<li><code>通知ログ</code> を開いて、失敗理由を確認します</li>
<li>多い原因:</li>
</ol>
<ul>
<li><code>部署マスタ</code> に部署が無い / 無効になっている</li>
<li><code>通知先To</code> が空</li>
<li><code>Web回答URL（デプロイURL）</code> が空</li>
</ul>
<p>原因を直したら、メニュー <code>車両更新通知</code> → <code>初回メール送信</code> を実行します。</p>
<p>補足:</p>
<ul>
<li>送信対象は、基本的に <code>更新依頼</code> のステータスが「作成済」のものです。</li>
<li>再送が必要な場合は、対象行のステータスを「作成済」に戻してから <code>初回メール送信</code> を実行してください（やりすぎると二重送信になります）。</li>
<li>ステータスが「完了」の依頼は、リンクを無効化するため再送できません（必要なら新規依頼として取り扱います）。</li>
</ul>
<h3>6.2 <code>要入力</code> に出ている（通知できない車両がある）</h3>
<p><code>要入力</code> に出た行の「不備内容」を見て、元台帳で直します。</p>
<ul>
<li><code>契約満了日なし</code> → 元台帳に満了日を入力</li>
<li><code>管理部門なし</code> → 元台帳に管理部門を入力</li>
<li><code>部署マスタ未登録</code> → <code>部署マスタ</code> に追加、または元台帳の表記を合わせる</li>
</ul>
<p>修正後、メニュー <code>車両更新通知</code> → <code>車両統合ビュー同期</code> を実行します。</p>
<h3>6.3 回答したのに台帳に反映されない</h3>
<p>まずは <code>回答</code> タブに回答行が増えているか確認します。増えていない場合は、回答URLの問題の可能性があります。</p>
<p>回答が入っているのに反映が弱い場合は、メニュー <code>車両更新通知</code> → <code>回答反映</code> を実行します。</p>
<p>回答URLを開いたときにエラーが出る場合（例: 「パラメータが不足しています」「トークンが一致しません」「この依頼は完了しています」）は、運用担当へ連絡してください。</p>
<hr>
<h2>7. 台帳に追加される列（自動で増えます）</h2>
<p>元台帳（<code>車両一覧</code> など）の右端に、次の列が追加されて更新されます。</p>
<ul>
<li><code>更新方針</code>（再リース/新車入替/廃止/未定）</li>
<li><code>依頼ID</code>（どの依頼に紐づくか）</li>
<li><code>回答日</code>（回答が入った日時）</li>
<li><code>備考</code>（コメント）</li>
</ul>
<hr>
<h2>8. やってはいけないこと</h2>
<ul>
<li>タブ名を変更/削除しない（特に <code>設定</code> / <code>部署マスタ</code> / <code>更新依頼</code> / <code>回答</code> / <code>通知ログ</code> / <code>要入力</code> / <code>回答集計</code>）</li>
<li>1行目（見出し行）の文字を勝手に変えない</li>
<li>回答URLを社外へ転送しない</li>
</ul>

    <div class="footer">このページはMarkdownから自動生成されています。</div>
  </body>
</html>
