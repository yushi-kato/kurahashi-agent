# 運用マニュアル（クライアント向け）: 車両リース契約 更新通知ツール（半期一括）

このドキュメントは、半期ごとに「契約満了が近い車両」を一括で通知し、確認用シートで回答・承認・反映まで進める**日常運用手順**をまとめたものです。

（作成日: 2026-02-06）

---

## 1. このツールでできること（ざっくり）
1) 半期レンジ（3月/9月）+ 過去未反映分をまとめて抽出する
2) 本部長/副本部長へ確認用シートの通知を送る
3) 回答確認済みで専務に承認依頼を送る
4) 村田主任の入力（更新日付 or 解約完了）を受けて台帳へ反映する
5) 送信・反映の履歴を `通知ログ` に記録する

---

## 2. 触る場所（タブ）
普段よく見るのは次のタブです。

- `車両一覧`（元台帳）
  - ここにある「契約満了日」「管理部門」などを元に抽出します
  - 反映時に `契約開始日` / `契約満了日` を更新、解約は行全体をグレーアウトします
- `通知バッチ`
  - 半期ごとの送付単位を管理します（送付日/期限/ステータス）
- `本部長副本部長確認_YYYYMMDD`
  - 本部長/副本部長の回答、専務判断、反映情報を入力する確認用シートです
- `要入力`
  - 「契約満了日が無い」など、抽出できない原因が一覧で出ます
- `通知ログ`
  - メール送信/反映の成功・失敗が記録されます
- `設定`
  - 通知先や半期日付、期限、リマインド日数などの設定を管理します

---

## 3. 本部長/副本部長の手順（確認用シート）
通知メールが届いたら、次を行います。

1) メール内の「確認シート」を開く
2) 各車両の `本部回答` を入力する（更新 / 解約（入替） / 解約（満了））
3) 入力が終わったら `回答確認済み` にチェックを付ける

---

## 4. 専務の手順（承認）
1) 専務宛の通知メールから確認用シートを開く
2) 各車両の `専務判断` を入力する（承認 / 差戻し）
3) 必要に応じて `専務コメント` を入力する

※ `専務判断` / `専務コメント` は専務のみ編集可能です（列保護あり）。

---

## 5. 運用担当（村田主任）の手順（反映）
1) 承認済み行に対して、次を入力します
   - 更新: `新契約開始日` / `新契約満了日`
   - 解約: `解約完了` チェック
2) メニュー `車両更新通知` → `専務判断反映・マスター更新` を実行します
3) 台帳（`車両一覧`）に反映されたことを確認します

---

## 6. 定期運用（半期）
### 6.1 半期バッチ作成
- 3月1日 / 9月1日にメニュー `車両更新通知` → `半期バッチ作成` を実行します
- 実行後、`通知バッチ` と `本部長副本部長確認_YYYYMMDD` が生成されます

### 6.2 通知の流れ
- `本部長/副本部長 初回通知送信`
- 期限10日前に未確認が残っていれば `本部長/副本部長 リマインド送信`
- 全件 `回答確認済み` で `専務 承認依頼送信`

---

## 7. 初期設定（最初に1回だけ）
※ここは「スプレッドシートの管理者」向けです。設定済みなら飛ばしてください。

### 7.1 メニューが出ることを確認
スプレッドシートを開くと、上部メニューに `車両更新通知` が出ます。

初回は権限確認が出ることがあります。案内に従って許可してください。

### 7.2 必要タブを作る（スキーマ同期）
メニュー `車両更新通知` → `スキーマ同期`

### 7.3 設定を入れる
タブ `設定` で、最低限次を確認します。
- `本部長副本部長_通知先To`
- `専務_通知先To` / `専務_通知先Cc`
- `半期送付日_3月` / `半期送付日_9月`
- `回答期限_3月` / `回答期限_9月`
- `リマインド_期限前日数`
- `通知_メール送信`（TRUEで送信、FALSEで送らない）

### 7.4 自動実行（平日朝）を設定する
自動実行が必要な場合は、メニュー `車両更新通知` → `日次トリガー再作成` を実行します。

---

## 8. 困ったとき（よくある原因と対処）
### 8.1 メールが送られていない/失敗している
1) `通知ログ` を開いて、失敗理由を確認します
2) 多い原因:
   - `本部長副本部長_通知先To` が空
   - `専務_通知先To` が空
   - `通知_メール送信` が FALSE

原因を直したら、メニュー `車両更新通知` → 該当の送信メニューを実行します。

### 8.2 `要入力` に出ている（抽出できない車両がある）
`要入力` に出た行の「不備内容」を見て、元台帳で直します。
- `契約満了日が未設定` → 元台帳に満了日を入力

修正後、次回の `半期バッチ作成` で対象化されます。

### 8.3 反映されない
- `専務判断` が「承認」になっているか
- `新契約開始日` / `新契約満了日` または `解約完了` が入力されているか
- メニュー `専務判断反映・マスター更新` を実行したか

---

## 9. 台帳に追加される列（自動で増えます）
元台帳（`車両一覧`）の右端に、次の列が追加されます。

- `マスター反映済み`
- `反映日時`

---

## 10. やってはいけないこと
- タブ名を変更/削除しない（特に `設定` / `通知バッチ` / `通知ログ` / `要入力`）
- 1行目（見出し行）の文字を勝手に変えない
